name: Postman Collection API test

on:
  schedule:
    # Run workflow at 6 AM and 6 PM IST
    - cron: "30 0,12 * * *"
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  api_tests:
    name: Run Postman Collection on integ env
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      #  Not installing the newman since it's already included in the Ubuntu image.
      #- name: Install Newman
      #  run: npm install -g newman

      # - name: Install portman
      #   run: npm install -g @apideck/portman

      # - name: Generate postman collection
      #   run: portman --cliOptionsFile postman/portman-cli.json

  run_api_test_stripe:
    name: Run Postman Collection
    runs-on: ubuntu-latest
    needs: api_tests
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Run Newman
        run:
          newman run postman/hyperswitch.postman_collection.json --env-var admin_api_key=${{ secrets.INTEG_ADMIN_API_KEY }} --env-var baseUrl=${{ secrets.INTEG_BASE_URL }} --env-var connector_api_key=${{ secrets.STRIPE_API_KEY }}
          --env-var gateway_merchant_id=${{ secrets.STRIPE_GATEWAY_MERCHANT_ID }} --env-var certificate=${{ secrets.STRIPE_GPAY_CERTIFICATE }} --env-var certificate_keys=${{ secrets.STRIPE_GPAY_CERTIFICATE_KEYS }}
